<!-- listings/new.ejs -->

<% layout("/layouts/boilerplate") %>
  <div class="row mt-3">

    <div class="col-8 offset-2">
      <br>
      <h1>Create a new listing</h1>
      <form method="POST" id="listing-form" action="/listings" novalidate class="needs-validation"
        enctype="multipart/form-data">

        <div class="mb-3 mt-4">
          <label for="title" class="form-label">
            <h5>Title:</h5>
          </label>
          <input name="listing[title]" placeholder="Enter title" type="text" class="form-control" required>
          <div class="invalid-feedback">Title is required.</div>
        </div>

        <div class="mb-3 mt-4">
          <label for="description" class="form-label">
            <h5>Description</h5>
          </label>
          <textarea name="listing[description]" placeholder="Enter description" class="form-control"
            required></textarea>
          <div class="invalid-feedback">Description is required.</div>
        </div>
        <div class="mb-3 mt-4">
          <label for="image" class="form-label">
            <h5>Upload Listing Image</h5>
          </label>
          <input name="listing[image]" placeholder="Upload Listing Image" type="file" class="form-control">
        </div>
        <div class="mb-3 mt-4" id="category-group">
          <label class="form-label">
            <h5>Choose Categories</h5>
          </label>
          <div class="row">

            <% categories.forEach(cat=> { %>
              <div class="col-md-3 col-sm-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="listing[category][]" value="<%= cat %>"
                    id="cat-<%= cat.replace(/\s+/g, '-') %>">
                  <label class="form-check-label" for="cat-<%= cat.replace(/\s+/g, '-') %>">
                    <%= cat %>
                  </label>
                </div>
              </div>
              <% }) %>

          </div>
          <div class="invalid-feedback">Please select at least one category.</div>
        </div>
        <div class="mb-3 mt-4">
          <label class="form-label">
            <h5>Select Amenities</h5>
          </label>

          <% for (const [section, items] of Object.entries(amenities)) { %>
            <h6>
              <%= section %>
            </h6>
            <div class="row mb-2">
              <% items.forEach(item=> { %>
                <div class="col-md-3 col-sm-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="listing[amenities][<%= section %>][]"
                      value="<%= item %>" id="amenity-<%= item.replace(/\s+/g, '-') %>">
                    <label class="form-check-label" for="amenity-<%= item.replace(/\s+/g, '-') %>">
                      <%= item %>
                    </label>
                  </div>
                </div>
                <% }) %>
            </div>
            <% } %>
        </div>


        <div class="row mt-4">
          <div class="mb-3 col-md-4">
            <label for="price" class="form-label">
              <h5>Price</h5>
            </label>
            <input name="listing[price]" placeholder="Enter Price" type="number" class="form-control">
            <div class="invalid-feedback">Price must be a valid number greater than 0.</div>
          </div>

          <div class="mb-3 col-md-8">
            <label for="location" class="form-label">
              <h5>Location</h5>
            </label>
            <input name="listing[location]" placeholder="Enter Location" type="text" class="form-control" required>
            <div class="invalid-feedback">Location is required.</div>
          </div>
        </div>

        <div class="mb-3 mt-4">
          <label for="country" class="form-label">
            <h5>Country</h5>
          </label>
          <input name="listing[country]" placeholder="Enter Country" type="text" class="form-control" required>
          <div class="invalid-feedback">Country is required.</div>
        </div>

        <button class="btn btn-dark add-btn mt-3">Add</button>
      </form>
    </div>
  </div>